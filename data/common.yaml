---
profile_audit::qualys::enabled: false
profile_audit::qualys::gid: "19999"
profile_audit::qualys::group: "qualys"
profile_audit::qualys::homedir: "/home/qualys"
profile_audit::qualys::ip: "141.142.148.51"
profile_audit::qualys::ssh_authorized_key: null
profile_audit::qualys::ssh_authorized_key_type: "rsa"
profile_audit::qualys::sshd_custom_cfg:
  PubkeyAuthentication: "yes"
  AuthenticationMethods: "publickey"
  Banner: "none"
  MaxAuthTries: "6"
  MaxSessions: "10"
  X11Forwarding: "no"
profile_audit::qualys::uid: "19999"
profile_audit::qualys::user: "qualys"
profile_audit::qualys::user_comment: "NCSA IRST Qualys - security@ncsa.illinois.edu"

profile_audit::root_equivalence::crons:
  "root equivalence reporting":
    command: "/root/scripts/k5login_otp_audit.pl > /dev/null 2>&1"
    environment:
      - "SHELL=/bin/sh"
    hour: 1
    minute: 1
    monthday: 1
    user: "root"
profile_audit::root_equivalence::files:
  "/root/scripts":
    ensure: "directory"
    mode: "0750"
    owner: "root"
    group: "root"
  "/root/scripts/k5login_otp_audit.pl":
    ensure: "present"
    mode: "0750"
    owner: "root"
    group: "root"
    content: |
      #!/usr/bin/perl
      #
      # Script to send .k5login files to security for auditing.
      #
      # Written by Tim Brooks 04/13/2005
      # Updated by Tim Brooks 09/13/2005
      # Updated by Tim Brooks 10/20/2005
      # Updated by Birkhoff Cheng 09/21/2021 (send files to syslog instead of email)
      use Sys::Hostname;
      use Sys::Syslog;
      chomp($option = $ARGV[0]);
      if ($option eq "-h" || $option eq "--help") { #Go to Usage subroutine for help with option of -h or --help.
          &Usage;
      } else {
          # Get the localhost name
          $hostname = hostname();
          $passwd = "/etc/passwd";
          # Get root's home directory
          open(PASSWD,$passwd);
          while (<PASSWD>){
              chomp;
              ($login, $passwd, $uid, $gid, $gcos, $home, $shell) = split /:/;
              if ($uid == 0){
                  $roothome = $home;
              }
              close (PASSWD);
          }
          $k5 = "$roothome/.k5login";
          # Get the .k5login file to send.
          if (-e $k5){
              open (K5LOGIN,$k5);
              openlog("$0", 0, "LOG_LOCAL0") or die "Cannot open log";
              @k5login = <K5LOGIN>;
              foreach $line (@k5login){
                  if ($line =~ /^\s*#/) { next; }
                  syslog(LOG_INFO, "$line");
              }
              close(K5LOGIN);
              closelog();
          }
      }
      sub Usage {# Print the usage.
          print "Usage:\n";
          print " k5login_otp_audit.pl\n";
          print "      -h          print this usage information\n";
          print "\n";
          exit;
      }
